\begin{proof}[\hyperanchor{pf:ahbtr-from-ahplbe}{Theorem~\ref{thm:ahbtr-from-ahplbe}}]
Consider any efficient adversary~$\scriptB$ against the traceability of Construction~\ref{con:ahbtr-from-ahplbe}.

\luoji{Consider acknowledging Hoeteck for the write-up style.}
Let $\GoodEst$ be the event that ${|\widehat{\epsilon}_i-\epsilon_i|\leq\delta}$ for all~${i\in[0..N]}$.
% $N$ is a random variable (and $\delta,\eta$ are functions of~$N$).
% It is incorrect to say
% \begin{align*}
% \Pr[\neg\GoodEst]\leq 2({N+1})\exp({-2\delta^2\eta}),
% \end{align*}
% as the left-hand side is a number (integration has been done with respect to the probability measure)
% whereas the right-hand side is not a number (it is a function from the sample space of the probability space).
By the Chernoff bound, the union bound, and the law of total probability,
\begin{align*}
\Pr[\neg\GoodEst]
=\E\bigl[\Pr[\neg\GoodEst\mid N]\bigr]
\leq\E[2({N+1})\exp({-2\delta^2\eta})]
\leq 2^{-\lambda}.
\end{align*}
Let $\BadEnd$ be the event that ${|\epsilon_N|>\frac{\epsilon^\ast}{2}}$,
then ${\GoodDist\wedge\neg\BadEnd}$ implies
% Here, ``implies'' means ``is a superset of'' (relation between events).
\begin{align*}
\max_{i\in[N]}{|\epsilon_{i-1}-\epsilon_i|}
&{}\geq
\frac1N\sum_{i=1}^{N}{|\epsilon_{i-1}-\epsilon_i|}
\geq
\frac1N\left|\sum_{i=1}^{N}{(\epsilon_{i-1}-\epsilon_i)}\right|
=
\frac1N|\epsilon_0-\epsilon_N|
\\&{}\geq
\frac1N(
% \GoodDist is \smash'ed and needs \vphantom to restore height.
\underset{\mathclap{\substack{\uparrow\\{\GoodDist}\quad\vphantom{G}}}}{|\epsilon_0|}
-
\underset{\mathclap{\substack{\uparrow\\\quad{\neg\BadEnd}\vphantom{G}}}}{|\epsilon_N|}
)
\geq
\frac1N\left(
\epsilon^\ast
-\frac{\epsilon^\ast}{2}
\right)
=
\frac{\epsilon^\ast}{2N}
=
5\delta.
\end{align*}
Therefore, ${\GoodDist\wedge\neg\BadEnd\wedge\GoodEst}$ implies
\begin{align*}
\max_{i\in[N]}{|\widehat{\epsilon}_{i-1}-\widehat{\epsilon}_i|}
\underset{\mathclap{\substack{
% \GoodEst is \smash'ed and needs \vphantom to restore height.
\big\uparrow\\\GoodEst\vphantom{G}
}}}{\geq}
\max_{i\in[N]}{(|\epsilon_{i-1}-\epsilon_i|-2\delta)}
\underset{\mathclap{\substack{
\big\uparrow\\\GoodDist\wedge\neg\BadEnd\vphantom{G}
}}}{\geq}
5\delta-2\delta
=
3\delta,
\end{align*}
which in turn implies ${T\neq\varnothing}$ hence ${i^\ast\in[N]}$, i.e.,
${\neg\NotFound}$.
By contraposition,
\begin{align*}
\GoodDist\wedge\NotFound\wedge\GoodEst
\quad\Longrightarrow\quad
\BadEnd.
\end{align*}
The following claims hold:

\begin{claim}[\hyperlink{pf:ahbtr-from-ahplbe-badend}{\P}]\label{clm:ahbtr-from-ahplbe-badend}
$\Pr[\GoodPKs\wedge\BadEnd]=\negl(\lambda)$.
\end{claim}

\begin{claim}[\hyperlink{pf:ahbtr-from-ahplbe-falsepos}{\P}]\label{clm:ahbtr-from-ahplbe-falsepos}
$\Pr[\GoodPKs\wedge\FalsePos\wedge\GoodEst]=\negl(\lambda)$.
\end{claim}

\noindent
Once Claims~\ref{clm:ahbtr-from-ahplbe-badend} and~\ref{clm:ahbtr-from-ahplbe-falsepos} are proved,
it follows that
\begin{align*}
\WideNarrow{}{&}
\Pr[\scriptB\textup{ wins}]
\WideNarrow{\leq{}&}{\\{}\leq{}&}
\Pr[\neg\GoodEst]
+
\Pr[(\scriptB\textup{ wins})\wedge\GoodEst]
\WideNarrow{}{\displaybreak[3]}\\{}\leq{}&
2^{-\lambda}
+
\Pr[\GoodPKs\wedge(\FalsePos\vee(\GoodDist\wedge\NotFound))\wedge\GoodEst]
\displaybreak[3]\\{}\leq{}&
2^{-\lambda}
+
\Pr[\GoodPKs\wedge\FalsePos\wedge\GoodEst]
\\&\hphantom{2^{-\lambda}}
+
\Pr[\GoodPKs\wedge\GoodDist\wedge\NotFound\wedge\GoodEst]
\displaybreak[3]\\{}\leq{}&
2^{-\lambda}
+
\Pr[\GoodPKs\wedge\FalsePos\wedge\GoodEst]
+
\Pr[\GoodPKs\wedge\BadEnd]
\\{}={}&
2^{-\lambda}+\negl(\lambda)+\negl(\lambda)
=
\negl(\lambda).
\qedhere
\end{align*}
\end{proof}

\begin{proof}[\hyperanchor{pf:ahbtr-from-ahplbe-falsepos}{Claim~\ref{clm:ahbtr-from-ahplbe-falsepos}}]
Given an efficient adversary~$\scriptB$ against the traceability of Construction~\ref{con:ahbtr-from-ahplbe},
let
\begin{itemize}
\item $\alpha$ be a random element in the traceability experiment,
\begin{align*}
\alpha=\begin{cases}
0,&\textup{if }i^\ast\in[N]\textup{ and }
\widehat{\epsilon}_{i^\ast-1}-\widehat{\epsilon}_{i^\ast}\geq 3\delta;\\
1,&\textup{if }i^\ast\in[N]\textup{ and }
\widehat{\epsilon}_{i^\ast-1}-\widehat{\epsilon}_{i^\ast}\leq -3\delta;\\
\bot,&\textup{if }i^\ast=\bot;
\end{cases}
\end{align*}
\item $B_1=\poly(\lambda)>1$ an upper bound of $Q$,
\item $B_2=\poly(\lambda)>1$ an upper bound of $N$, and
\item $B_3=\poly(\lambda)$ an upper bound of $1/\epsilon^\ast$.
\end{itemize}
Consider the following efficient adversary~$\scriptA$ against the index-hiding property of~$\AHPLBE$:
\begin{itemize}
\item Taking $\pk$ as input, $\scriptA$ samples and sets
\begin{align*}
q^\ast\draws[B_1],\quad
\pk_{q^\ast}\gets\pk,\WideNarrow{\qquad}{\quad}
(\pk_q,\sk_q)\draws\AHPLBE.\Gen()
\WideNarrow{\quad\textup{for }}{\textup{ for }}q\in[B_1]\setminus\{q^\ast\}.
\end{align*}
It launches $\scriptB$ and starts simulating $\ExpTrace$ for it.
\item When $\scriptB$ submits $1^Q$,
the adversary~$\scriptA$ sets ${S\gets[Q]}$ and sends back $\{\pk_q\}_{q\in[Q]}$.
\item When $\scriptB$ submits ${t\in[Q]}$ for~$\sk_t$,
the adversary~$\scriptA$ sets ${S\gets S\setminus\{t\}}$ and sends back~$\sk_t$,
except if ${t=q^\ast}$, in which case $\scriptA$ aborts.
\item When $\scriptB$ outputs $\scriptD,\{\pk^\ast_j\}_{j\in[N]},1^{1/\epsilon^\ast}$,
the adversary~$\scriptA$ runs
\begin{align*}
i^\ast\draws\Trace^\scriptD(\{\pk^\ast_j\}_{j\in[N]},1^{1/\epsilon^\ast}),
\end{align*}
and aborts
\begin{itemize}
\item if the public keys in $\{\pk^\ast_j\}_{j\in[N]}$ are not distinct,
\item if $i^\ast=\bot$, or
\item if ${i^\ast\in[N]}$ and ${q^\ast\neq\min{\{\,s\in S\::\:\pk^\ast_{i^\ast}=\pk_s\,\}}}$.
\end{itemize}
If not aborting,
$\scriptA$ notes down ${\alpha\in\bit}$ from the above simulation.
\item
$\scriptA$ submits $N,{i_\bot^\ast=i^\ast},\{\pk^\ast_j\}_{j\in[N]\setminus\{i_\bot^\ast\}}$ to the index-hiding experiment,
gets $(\mu,\ct)$ back,
samples and sets
\begin{align*}
\beta\draws\bit,\qquad
\mu_\beta\gets\mu,\quad
\mu_{\neg\beta}\draws\bit^\lambda,
\end{align*}
and runs and outputs
${b'\draws\scriptD(\mu_0,\mu_1,\ct)\oplus\neg\beta\oplus\alpha}$.
\end{itemize}
Let $\NoAbort$ be the event that $\scriptA$ does not abort.
Routine calculation shows that the advantage of~$\scriptA$ is
\begin{align*}
&
\E_\scriptA[\1_\NoAbort\cdot(-1)^\alpha(\epsilon_{i^\ast-1}-\epsilon_{i^\ast})]
\WideNarrow{=}{\\&\qquad{}={}}
B_1^{-1}\E_\scriptB[\1_\GoodPKs\cdot\1_\FalsePos\cdot(-1)^\alpha(\epsilon_{i^\ast-1}-\epsilon_{i^\ast})],
\end{align*}
which must be negligible by the index-hiding property of~$\AHPLBE$.
% This is terrible.
% An implicit coupling is going on.
Here, $\E_\scriptA$ (similarly $\Pr_\scriptA$, resp.~$\E_\scriptB$ and $\Pr_\scriptB$) signifies that the probability space is defined for the index-hiding (resp.~traceability) experiment.

${\FalsePos\wedge\GoodEst}$ implies
% $\FalsePos$ is to ensure ${i^\ast\neq\bot}$ so that
% it makes sense to talk about $\epsilon_{i^\ast}$, etc.
\begin{align*}
&
|
(\epsilon_{i^\ast-1}-\epsilon_{i^\ast})
-
(\widehat{\epsilon}_{i^\ast-1}-\widehat{\epsilon}_{i^\ast})
|
\leq
2\delta
<
3\delta
\leq
|\widehat{\epsilon}_{i^\ast-1}-\widehat{\epsilon}_{i^\ast}|
\\{}\Longrightarrow{}\quad&
(-1)^\alpha(\epsilon_{i^\ast-1}-\epsilon_{i^\ast})
=|\epsilon_{i^\ast-1}-\epsilon_{i^\ast}|
\geq 3\delta-2\delta
=\frac{\epsilon^\ast}{10N}
\geq\frac{1}{10B_2B_3}.
\end{align*}
Moreover, ${(-1)^\alpha(\epsilon_{i^\ast-1}-\epsilon_{i^\ast})\geq -1}$ always holds.
These together show that
\begin{align*}
&
\Pr_\scriptB[\GoodPKs\wedge\FalsePos\wedge\GoodEst]
\\{}={}&
10B_2B_3\E_\scriptB\left[
\1_\GoodPKs\cdot\1_\FalsePos\cdot\1_\GoodEst\cdot\frac{1}{10B_2B_3}
\right]
% \displaybreak[3]
\\{}\leq{}&
10B_2B_3\E_\scriptB\left[
\1_\GoodPKs\cdot\1_\FalsePos\cdot\1_\GoodEst
\cdot(-1)^\alpha(\epsilon_{i^\ast-1}-\epsilon_{i^\ast})
\right]
% \displaybreak[3]
\\{}\leq{}&
10B_2B_3\Bigl(
\E_\scriptB[
\1_\GoodPKs\cdot\1_\FalsePos\cdot\1_\GoodEst
\cdot(-1)^\alpha(\epsilon_{i^\ast-1}-\epsilon_{i^\ast})
]
\\&
\hphantom{10B_2B_3\Bigl({}}{}
+
\E_\scriptB[
\1_\GoodPKs\cdot\1_\FalsePos\cdot\1_{\neg\GoodEst}
\cdot(-1)^\alpha(\epsilon_{i^\ast-1}-\epsilon_{i^\ast})
]
\\&
\hphantom{10B_2B_3\Bigl({}}{}
+
\E_\scriptB[\1_\GoodPKs\cdot\1_\FalsePos\cdot\1_{\neg\GoodEst}]
\Bigr)
% \displaybreak[3]
\\{}={}&
10B_2B_3\Bigl(
\E_\scriptB[
\1_\GoodPKs\cdot\1_\FalsePos
\cdot(-1)^\alpha(\epsilon_{i^\ast-1}-\epsilon_{i^\ast})
]
\\&\hphantom{10B_2B_3\Bigl({}}{}
+\Pr_\scriptB[\GoodPKs\wedge\FalsePos\wedge\neg\GoodEst]
\Bigr)
% \displaybreak[3]
\\{}\leq{}&
10B_2B_3\left(
B_1\E_\scriptA[
\1_\NoAbort\cdot(-1)^\alpha(\epsilon_{i^\ast-1}-\epsilon_{i^\ast})
]
+2^{-\lambda}
\right)
\\{}={}&
10\poly(\lambda)\poly(\lambda)
\bigl(\poly(\lambda)\negl(\lambda)+\negl(\lambda)\bigr)
=\negl(\lambda).
\qedhere
\end{align*}
\end{proof}
