\documentclass[letterpaper,11pt,oneside,onecolumn,final]{article}

\def\widenarrow#1#2{#1}
\long\def\WideNarrow#1#2{#1}

% Use LNCS leveling:
\setcounter{secnumdepth}{2}
\def\subsubsection{\@startsection{subsubsection}{3}{\z@}%
{-12\p@ \@plus -4\p@ \@minus -4\p@}%
{-0.5em \@plus -0.22em \@minus -0.1em}%
{\normalfont\normalsize\bfseries\boldmath}}
\def\paragraph{\@startsection{paragraph}{4}{\z@}%
{-12\p@ \@plus -4\p@ \@minus -4\p@}%
{-0.5em \@plus -0.22em \@minus -0.1em}%
{\normalfont\normalsize\itshape}}

% Use LNCS captioning:
\long\def\@makecaption#1#2{%
  \small%
  \vskip\abovecaptionskip%
  \sbox\@tempboxa{{\bfseries #1.} #2}%
  \ifdim \wd\@tempboxa >\hsize%
    {\bfseries #1.} #2\par%
  \else%
    \global \@minipagefalse%
    \hb@xt@\hsize{\hfil\box\@tempboxa\hfil}%
  \fi%
  \vskip\belowcaptionskip%
}

% Supplement missing commands for metadata.
\let\titlerunning\Laomian@EatOneArgument
\let\orcidID\Laomian@EatOneArgument
\let\authorrunning\Laomian@EatOneArgument

\let\Laomian@Institute\relax
\def\inst#1{\unskip\textsuperscript{#1}}
\def\institute#1{\global\def\Laomian@Institute{#1}}
\def\email#1{\texttt{#1}}

\def\keywords#1{%
  \begingroup%
  \def\and{\unskip, }%
  \addvspace{2ex}\noindent\textbf{Keywords.} #1\@addpunct{.}\par%
  \endgroup%
}

% Create indentation for subsequent paragraphs of abstract (not needed).
\let\abstractparindent\relax

% Date the document.
\AtBeginDocument{\date{\ifcase\month%
  \or January\or February\or March\or April\or May\or June%
  \or July\or August\or September\or October\or November\or December%
  \fi\ \number\year%
}}

% \maketitle
\def\maketitle{%
  \begingroup%
  \null%
  \vskip 2em\relax%
  \begin{center}%
    {\LARGE\@title\par}%
    \vskip 1.5em\relax%
    {%
      \large\lineskip .5em\relax%
      \begin{tabular}[t]{c}%
        \@author%
      \end{tabular}%
      \par%
    }%
    \vskip 1em\relax%
    \begingroup%
    % Count the number of institutes.
    \setcounter{footnote}{1}%
    \newbox\Laomian@InstituteBox%
    \def\and{%
      \par\vskip 0.4em\relax%
      \noindent\stepcounter{footnote}%
      \textsuperscript{\arabic{footnote}}\,\ignorespaces%
    }%
    \setbox\Laomian@InstituteBox\vbox{\Laomian@Institute}%
    \par\noindent%
    \ifnum\c@footnote=1%
      % If there is only one institute, no need for the numbers.
      \setcounter{footnote}{0}%
    \else%
      % If there are 2 or more institutes,
      % they will be formatted like footnotes, and
      % "real" footnote numbering should continue from there.
      % This behavior comes from LNCS, but
      % it is suppressed if a separate title page is used.
      % See the definitions of \TypesetTableOfContents.
      \setcounter{footnote}{1}%
      \textsuperscript{1}\,\ignorespaces%
    \fi%
    \Laomian@Institute%
    \endgroup%
    \par\vskip 1em\relax%
    {\large \@date}%
  \end{center}%
  \par\vskip 1.2em\relax%
  \endgroup%
}

% Page layout.
\usepackage[letterpaper,textwidth=6in,textheight=9in,centering]{geometry}

% Show frames and create space for notes in draft mode.
\ifLaomianDraft@
\geometry{showframe}
\setlength\oddsidemargin{-0.8in}
\setlength\marginparwidth{2in}
\fi

% Page numbers are always enabled for ePrint.
\usepackage{lastpage}
\def\Laomian@PageStyle{%
  \pagenumbering{arabic}%
  \pagestyle{plain}%
  \def\@oddfoot{\hfil\thepage~/~\pageref*{LastPage}\hfil}
  \let\@evenfoot\@oddfoot
}
\def\Laomian@TitlePageStyle{%
  \pagenumbering{roman}%
  \pagestyle{plain}%
  \def\@oddfoot{\hfil\thepage\hfil}
  \let\@evenfoot\@oddfoot
}

\input{.laomian/basics}

% Underlines.
\def\ULdepth{0.45ex}
\contourlength{0.32ex}
\def\ul#1{\uline{\phantom{\contour*{white}{#1}}}\llap{\contour*{white}{#1}}}

% Reference names
\def\Figure{Figure}
\def\Equation{Equation}
\def\Section{Section}
\def\Figures{Figures}
\def\Equations{Equations}
\def\Sections{Sections}

\input{.laomian/links}

\input{.laomian/maths}

% Table of contents.
\ifLaomianTOC@
\usepackage{tocloft}
\setcounter{tocdepth}{2}
\def\cfttoctitlefont{\vspace*{1ex}\hfill\LARGE\bfseries}
\def\cftaftertoctitle{\hfill\vspace*{1ex}}
\def\cftsecleader{\hfil}
\def\cftsecfont{\bfseries}
\def\cftsecpagefont{\bfseries}
\setlength{\cftbeforesecskip}{0.4em}
\setlength{\cftbeforesubsecskip}{0.1em}
% Use alternative numbering for the title page and the table of contents.
\def\TypesetTableOfContents{%
  % Disable link coloring in the table of contents.
  \let\Laomian@TOC@Hy@colorlink@bak\Hy@colorlink%
  \def\Hy@colorlink##1{\begingroup}%
  % Print the table of contents.
  \newpage\tableofcontents%
  % Restore link coloring.
  \let\Hy@colorlink\Laomian@TOC@Hy@colorlink@bak%
  \let\Laomian@TOC@Hy@colorlink@bak\Laomian@undefined%
  % Restore numbering.
  % The footnote counter is reset even if there are multiple institutes.
  \newpage%
  \setcounter{page}{1}%
  \setcounter{footnote}{0}%
  \Laomian@PageStyle%
}
\def\Laomian@AppendixInTOC{%
  \addtocontents{toc}{%
    \protect\vskip 1.6em\protect\relax%
    {\protect\Large Appendix}%
    \protect\par%
  }%
}
\def\Laomian@BibInTOC@Begin{%
  % Back up \section.
  \let\Laomian@BibInTOC@section@bak\section%
  \def\section{\@ifstar\Laomian@BibInTOC@section\Laomian@BibInTOC@section}%
  \def\Laomian@BibInTOC@section##1{%
    % Produce \section*{References} and add it to the table of contents.
    \Laomian@BibInTOC@section@bak*{References}%
    \addcontentsline{toc}{section}{References}%
  }%
}
\def\Laomian@BibInTOC@End{%
  % Restore \section.
  \let\section\Laomian@BibInTOC@section@bak%
  \let\Laomian@BibInTOC@section@bak\Laomian@undefined%
  \let\Laomian@BibInTOC@section\Laomian@undefined%
}
\else
% Table of contents is hidden.
\ifLaomianTitlePage@
% Use separate title page without page number.
\def\Laomian@TitlePageStyle{%
  \pagenumbering{roman}%
  \pagestyle{empty}%
}
\def\TypesetTableOfContents{%
  % Restore numbering.
  % The footnote counter is reset even if there are multiple institutes.
  \newpage%
  \setcounter{page}{1}%
  \setcounter{footnote}{0}%
  \Laomian@PageStyle%
}
\else
% Do not use separate title page.
\let\Laomian@TitlePageStyle\Laomian@PageStyle
\Laomian@PageStyle
\fi
\fi

% Fonts.
\ifLaomianFonts@
\usepackage[default,lining,semibold,regular,scaled=0.9]{sourcecodepro}
\usepackage[default,lining,proportional,semibold,regular]{sourcesanspro}
\usepackage[default,lining,proportional,bold,regular]{sourceserifpro}
\usepackage[smallerops,varvw,varg,ncf,varbb,cmbraces,bigdelims,nonewtxmathopt,subscriptcorrection]{newtxmath}
\usepackage[cal=cm]{mathalfa}
% Adjust inter-word spacing for Source Serif Pro.
\AtBeginDocument{\relax\spaceskip=%
1.28\fontdimen2\font
plus 1.16666667\fontdimen3\font
minus 1\fontdimen4\font\relax}
% Adjust underline thickness to match Source Serif Pro.
\def\ULthickness{0.111111ex}
% Re-apply math-typesetting orthodoxy.
\let\emptyset\varnothing
\let\varemptyset\varnothing
\let\nothing\varnothing
\def\vec#1{\boldsymbol{\mathbf{#1}}}
% Use \upomega (from the fancy fonts) for \smallomega.
\def\smallomega{\operatorname{\upomega}}
% Match the new blackboard bold font.
\def\1{{\mathds{1}}}
\fi
